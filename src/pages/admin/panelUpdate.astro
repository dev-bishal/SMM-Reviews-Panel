---

import { isAdminLoggedIn } from "../../js/utils";
import AdminLayout from "../../layouts/adminLayout.astro";
import AdminPanelFields from "../../layouts/adminPanelFields.astro";
var messageToShow = "", showOverlaw = false;

const panelID = Astro.cookies.get("updatePanelID");
// console.log("Panel ID to Update - ", panelID?.value);

if(!isAdminLoggedIn(panelID)){
    return Astro.redirect("/admin/SMMPanel/");
}

if (Astro.request.method === "POST") {
    try {
        const data = await Astro.request.formData();
        console.log("Form Data at client side - ", data);
        
        showOverlaw = true;
        const response = await fetch(Astro.site + "api/panels/" + panelID?.value, {
            method: "PUT",
            body: data,
        });

        const APIResponse = await response.json();
        if (APIResponse.message == "Data Updated Successfully") {
            messageToShow =
                "SMM Panel is Updated. Click here to see all Saved SMM Panels";
        }
    } catch (error) {
        if (error instanceof Error) {
            console.error(error.message);
        }
    }
    showOverlaw = false;
}

const fetchPanelInfo = await fetch(Astro.site + "api/panels/"+panelID?.value);
const panelInfo = await fetchPanelInfo.json();

---

<AdminLayout pageName="Update Panel" pageTitle="Update Panel" showOverlaw={showOverlaw}>
    {
        messageToShow && (
            <span
                class="toast hidden"
                id="toast"
                data-message={messageToShow}
            />
        )
    }
    
    <AdminPanelFields panelInfo={panelInfo} formType="update"></AdminPanelFields>

</AdminLayout>
