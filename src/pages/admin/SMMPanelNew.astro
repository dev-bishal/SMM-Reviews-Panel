---
import AdminLayout from "../../layouts/adminLayout.astro";
import AdminPanelFields from "../../layouts/adminPanelFields.astro";

var messageToShow = "";
let showOverlay = false;

if (Astro.request.method === "POST") {
    showOverlay = true;
    try {
        const data = await Astro.request.formData();
        // console.log("Form Data at client side - ", data);

        const response = await fetch(Astro.site + "api/panels.json", {
            method: "POST",
            body: data,
        });

        const APIResponse = await response.json();
        if (APIResponse.message == "Data Saved Successfully") {
            messageToShow =
                "SMM Panel is saved. Click here to see all Saved SMM Panels";
        }
    } catch (error) {
        if (error instanceof Error) {
            console.error(error.message);
        }
    }
}
---

<AdminLayout pageName="New SMM Panels" pageTitle="New SMM Panels" showOverlaw={showOverlay}>
    <AdminPanelFields formType="publish"></AdminPanelFields>

    {
        messageToShow && (
            <span
                class="toast hidden"
                id="toast"
                data-message={messageToShow}
            />
        )
    }
</AdminLayout>
